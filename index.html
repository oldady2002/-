<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é£²æ–™åº«å­˜ç®¡ç†ç³»çµ±</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300;400;500;600&display=swap');
        
        body {
            font-family: 'Noto Sans TC', sans-serif;
            background: linear-gradient(135deg, #F2EBBF 0%, #8CBEB2 100%);
            min-height: 100vh;
        }
        
        .muji-card {
            background: #ffffff;
            border: 1px solid #8CBEB2;
            box-shadow: 0 4px 12px rgba(92, 75, 81, 0.1);
        }
        
        .muji-button {
            background: #5C4B51;
            color: white;
            border: none;
            transition: all 0.2s ease;
        }
        
        .muji-button:hover {
            background: #F3B562;
            transform: translateY(-1px);
        }
        
        .muji-button-outline {
            background: transparent;
            color: #5C4B51;
            border: 1px solid #5C4B51;
            transition: all 0.2s ease;
        }
        
        .muji-button-outline:hover {
            background: #5C4B51;
            color: white;
            transform: translateY(-1px);
        }
        
        .bucket-stack {
            display: flex;
            flex-direction: row;
            align-items: flex-end;
            justify-content: center;
            min-height: 120px;
            max-height: 200px;
            overflow: hidden;
            margin: 0 auto;
            gap: 8px;
        }
        
        .bucket-column {
            display: flex;
            flex-direction: column-reverse;
            gap: 2px;
            align-items: center;
        }
        
        .small-bucket {
            width: 18px;
            height: 16px;
            position: relative;
            margin-bottom: 2px;
            transition: all 0.3s ease;
        }
        
        .small-bucket-container {
            width: 100%;
            height: 100%;
            background: #f5f5f5;
            border: 1px solid #8CBEB2;
            border-radius: 0 0 4px 4px;
            position: relative;
            overflow: hidden;
        }
        
        .small-bucket-liquid {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            border-radius: 0 0 3px 3px;
            transition: height 0.3s ease;
        }
        
        .small-bucket-handle {
            position: absolute;
            top: 3px;
            right: -3px;
            width: 6px;
            height: 6px;
            border: 1px solid #8CBEB2;
            border-left: none;
            border-radius: 0 3px 3px 0;
        }
        
        .bucket-stack-large {
            min-height: 160px;
            max-height: 320px;
        }
        
        .bucket-stack-large .small-bucket {
            width: 32px;
            height: 26px;
        }
        
        .bucket-stack-large .small-bucket-handle {
            width: 10px;
            height: 10px;
            right: -5px;
            top: 6px;
        }
        
        .tea-red { background: #F06060; }
        .tea-green { background: #8CBEB2; }
        .coffee-brown { background: #5C4B51; }
        .milk-tea-beige { background: #F3B562; }
        
        .role-selector {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 50;
        }
        
        .notification {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: #5C4B51;
            color: white;
            padding: 12px 24px;
            border-radius: 8px;
            opacity: 0;
            transition: opacity 0.3s ease;
            z-index: 100;
            box-shadow: 0 4px 12px rgba(92, 75, 81, 0.3);
        }
        
        .notification.show {
            opacity: 1;
        }
    </style>
</head>
<body class="min-h-screen">
    <!-- è§’è‰²é¸æ“‡å™¨ -->
    <div class="role-selector">
        <select id="roleSelector" class="px-4 py-2 border border-gray-300 rounded-lg bg-white text-sm">
            <option value="manager">å¤§ç¸½ç®¡</option>
            <option value="store1">ä¿¡ç¾©åº—åº—å°äºŒ</option>
            <option value="store2">å¿ å­åº—åº—å°äºŒ</option>
            <option value="store3">å¤§å®‰åº—åº—å°äºŒ</option>
            <option value="store4">æ¾å±±åº—åº—å°äºŒ</option>
            <option value="store5">ä¸­å±±åº—åº—å°äºŒ</option>
            <option value="store6">è¬è¯åº—åº—å°äºŒ</option>
            <option value="store7">å…§æ¹–åº—åº—å°äºŒ</option>
            <option value="store8">å£«æ—åº—åº—å°äºŒ</option>
        </select>
    </div>

    <!-- é€šçŸ¥ -->
    <div id="notification" class="notification">
        åº«å­˜å·²æ›´æ–°
    </div>

    <!-- ä¸»è¦å…§å®¹ -->
    <div class="container mx-auto px-4 py-8 max-w-6xl">
        <!-- æ¨™é¡Œ -->
        <div class="text-center mb-8">
            <h1 class="text-3xl font-light mb-2" style="color: #5C4B51;">é£²æ–™åº«å­˜ç®¡ç†</h1>
            <p class="font-light" style="color: #5C4B51; opacity: 0.8;">ç°¡æ½” Â· ç›´è¦º Â· é«˜æ•ˆ</p>
        </div>

        <!-- å€ç¶“ç†ç¸½è¦½è¦–åœ– -->
        <div id="managerView" class="space-y-8">
            <!-- ç¸½åº«å­˜æ¦‚è¦½ -->
            <div class="muji-card rounded-lg p-6">
                <h2 class="text-xl font-medium text-gray-800 mb-6 text-center">ç¸½åº«å­˜æ¦‚è¦½</h2>
                <div class="grid grid-cols-4 gap-6">
                    <div class="text-center">
                        <h3 class="text-lg font-medium mb-4" style="color: #5C4B51;" id="totalBeverage1Name">ç´…èŒ¶</h3>
                        <div id="totalBeverage1Stack" class="flex justify-center items-center h-32">
                            <div class="w-20 h-24 relative">
                                <div class="w-full h-full bg-gray-100 border-2 rounded-b-lg relative overflow-hidden" style="border-color: #8CBEB2;">
                                    <div id="totalBeverage1Fill" class="absolute bottom-0 left-0 right-0 tea-red rounded-b-lg transition-all duration-300" style="height: 85%"></div>
                                </div>
                            </div>
                        </div>
                        <p class="mt-3 text-2xl font-light" style="color: #5C4B51;" id="totalBeverage1Count">56.5æ¡¶</p>
                        <p class="text-lg font-medium" style="color: #5C4B51;" id="totalBeverage1Percent">94%</p>
                        <p class="text-xs text-gray-500" id="totalBeverage1Initial">æœŸåˆ 60æ¡¶</p>
                    </div>
                    <div class="text-center">
                        <h3 class="text-lg font-medium mb-4" style="color: #5C4B51;" id="totalBeverage2Name">ç¶ èŒ¶</h3>
                        <div id="totalBeverage2Stack" class="flex justify-center items-center h-32">
                            <div class="w-20 h-24 relative">
                                <div class="w-full h-full bg-gray-100 border-2 rounded-b-lg relative overflow-hidden" style="border-color: #8CBEB2;">
                                    <div id="totalBeverage2Fill" class="absolute bottom-0 left-0 right-0 tea-green rounded-b-lg transition-all duration-300" style="height: 75%"></div>
                                </div>
                            </div>
                        </div>
                        <p class="mt-3 text-2xl font-light" style="color: #5C4B51;" id="totalBeverage2Count">50.0æ¡¶</p>
                        <p class="text-lg font-medium" style="color: #5C4B51;" id="totalBeverage2Percent">83%</p>
                        <p class="text-xs text-gray-500" id="totalBeverage2Initial">æœŸåˆ 60æ¡¶</p>
                    </div>
                    <div class="text-center">
                        <h3 class="text-lg font-medium mb-4" style="color: #5C4B51;" id="totalBeverage3Name">å’–å•¡</h3>
                        <div id="totalBeverage3Stack" class="flex justify-center items-center h-32">
                            <div class="w-20 h-24 relative">
                                <div class="w-full h-full bg-gray-100 border-2 rounded-b-lg relative overflow-hidden" style="border-color: #8CBEB2;">
                                    <div id="totalBeverage3Fill" class="absolute bottom-0 left-0 right-0 coffee-brown rounded-b-lg transition-all duration-300" style="height: 70%"></div>
                                </div>
                            </div>
                        </div>
                        <p class="mt-3 text-2xl font-light" style="color: #5C4B51;" id="totalBeverage3Count">46.8æ¡¶</p>
                        <p class="text-lg font-medium" style="color: #5C4B51;" id="totalBeverage3Percent">78%</p>
                        <p class="text-xs text-gray-500" id="totalBeverage3Initial">æœŸåˆ 60æ¡¶</p>
                    </div>
                    <div class="text-center">
                        <h3 class="text-lg font-medium mb-4" style="color: #5C4B51;" id="totalBeverage4Name">å¥¶èŒ¶</h3>
                        <div id="totalBeverage4Stack" class="flex justify-center items-center h-32">
                            <div class="w-20 h-24 relative">
                                <div class="w-full h-full bg-gray-100 border-2 rounded-b-lg relative overflow-hidden" style="border-color: #8CBEB2;">
                                    <div id="totalBeverage4Fill" class="absolute bottom-0 left-0 right-0 milk-tea-beige rounded-b-lg transition-all duration-300" style="height: 60%"></div>
                                </div>
                            </div>
                        </div>
                        <p class="mt-3 text-2xl font-light" style="color: #5C4B51;" id="totalBeverage4Count">40.8æ¡¶</p>
                        <p class="text-lg font-medium" style="color: #5C4B51;" id="totalBeverage4Percent">68%</p>
                        <p class="text-xs text-gray-500" id="totalBeverage4Initial">æœŸåˆ 60æ¡¶</p>
                    </div>
                </div>
            </div>



            <!-- é£²æ–™è¨­å®šç®¡ç† -->
            <div class="muji-card rounded-lg p-6">
                <h3 class="text-lg font-medium text-gray-800 mb-4">é£²æ–™è¨­å®šç®¡ç†</h3>
                <div class="grid grid-cols-4 gap-4 mb-6">
                    <div class="text-center">
                        <label class="block text-sm text-gray-600 mb-2">é£²æ–™1</label>
                        <input type="text" id="beverage1Name" class="w-full px-3 py-2 border border-gray-300 rounded-lg text-center" value="ç´…èŒ¶">
                    </div>
                    <div class="text-center">
                        <label class="block text-sm text-gray-600 mb-2">é£²æ–™2</label>
                        <input type="text" id="beverage2Name" class="w-full px-3 py-2 border border-gray-300 rounded-lg text-center" value="ç¶ èŒ¶">
                    </div>
                    <div class="text-center">
                        <label class="block text-sm text-gray-600 mb-2">é£²æ–™3</label>
                        <input type="text" id="beverage3Name" class="w-full px-3 py-2 border border-gray-300 rounded-lg text-center" value="å’–å•¡">
                    </div>
                    <div class="text-center">
                        <label class="block text-sm text-gray-600 mb-2">é£²æ–™4</label>
                        <input type="text" id="beverage4Name" class="w-full px-3 py-2 border border-gray-300 rounded-lg text-center" value="å¥¶èŒ¶">
                    </div>
                </div>
                <div class="text-center">
                    <button class="muji-button px-6 py-2 rounded-lg" onclick="updateBeverageNames()">æ›´æ–°é£²æ–™åç¨±</button>
                </div>
            </div>

            <!-- åˆ†åº—è¨­å®šç®¡ç† -->
            <div class="muji-card rounded-lg p-6">
                <h3 class="text-lg font-medium text-gray-800 mb-4">åˆ†åº—è¨­å®šç®¡ç†</h3>
                <div class="grid grid-cols-2 lg:grid-cols-4 gap-4 mb-6">
                    <div class="text-center">
                        <label class="block text-sm text-gray-600 mb-2">åˆ†åº—1</label>
                        <input type="text" id="store1Name" class="w-full px-3 py-2 border border-gray-300 rounded-lg text-center" value="ä¿¡ç¾©åº—">
                    </div>
                    <div class="text-center">
                        <label class="block text-sm text-gray-600 mb-2">åˆ†åº—2</label>
                        <input type="text" id="store2Name" class="w-full px-3 py-2 border border-gray-300 rounded-lg text-center" value="å¿ å­åº—">
                    </div>
                    <div class="text-center">
                        <label class="block text-sm text-gray-600 mb-2">åˆ†åº—3</label>
                        <input type="text" id="store3Name" class="w-full px-3 py-2 border border-gray-300 rounded-lg text-center" value="å¤§å®‰åº—">
                    </div>
                    <div class="text-center">
                        <label class="block text-sm text-gray-600 mb-2">åˆ†åº—4</label>
                        <input type="text" id="store4Name" class="w-full px-3 py-2 border border-gray-300 rounded-lg text-center" value="æ¾å±±åº—">
                    </div>
                    <div class="text-center">
                        <label class="block text-sm text-gray-600 mb-2">åˆ†åº—5</label>
                        <input type="text" id="store5Name" class="w-full px-3 py-2 border border-gray-300 rounded-lg text-center" value="ä¸­å±±åº—">
                    </div>
                    <div class="text-center">
                        <label class="block text-sm text-gray-600 mb-2">åˆ†åº—6</label>
                        <input type="text" id="store6Name" class="w-full px-3 py-2 border border-gray-300 rounded-lg text-center" value="è¬è¯åº—">
                    </div>
                    <div class="text-center">
                        <label class="block text-sm text-gray-600 mb-2">åˆ†åº—7</label>
                        <input type="text" id="store7Name" class="w-full px-3 py-2 border border-gray-300 rounded-lg text-center" value="å…§æ¹–åº—">
                    </div>
                    <div class="text-center">
                        <label class="block text-sm text-gray-600 mb-2">åˆ†åº—8</label>
                        <input type="text" id="store8Name" class="w-full px-3 py-2 border border-gray-300 rounded-lg text-center" value="å£«æ—åº—">
                    </div>
                </div>
                <div class="text-center mb-6">
                    <button class="muji-button px-6 py-2 rounded-lg mr-4" onclick="updateStoreNames()">æ›´æ–°åˆ†åº—åç¨±</button>
                    <button class="muji-button-outline px-6 py-2 rounded-lg" onclick="showInitialInventoryModal()">è¨­å®šæœŸåˆåº«å­˜</button>
                </div>
            </div>

            <!-- åˆ†åº—ç¸½è¦½ -->
            <div class="grid grid-cols-2 lg:grid-cols-4 gap-4" id="storeOverview">
                <!-- å‹•æ…‹ç”Ÿæˆåˆ†åº—å¡ç‰‡ -->
            </div>

            <!-- ä¾¿ç•¶é»å¿ƒé…é€ç®¡ç† -->
            <div class="muji-card rounded-lg p-6">
                <h3 class="text-lg font-medium text-gray-800 mb-4">ä¾¿ç•¶é»å¿ƒé…é€ç®¡ç†</h3>
                <div class="text-center mb-6">
                    <button class="muji-button px-6 py-2 rounded-lg" onclick="showDeliverySettingsModal()">è¨­å®šå„åº—é…é€æ•¸é‡</button>
                    <button class="muji-button-outline px-6 py-2 rounded-lg ml-4" onclick="resetAllDeliveryStatus()">é‡ç½®æ‰€æœ‰å›å ±ç‹€æ…‹</button>
                </div>
                
                <!-- å„åº—å›å ±ç‹€æ…‹ç¸½è¦½ -->
                <div class="border-t pt-6">
                    <h4 class="text-md font-medium text-gray-700 mb-4">å„åº—å›å ±ç‹€æ…‹</h4>
                    <div id="deliveryStatusOverview" class="grid grid-cols-2 lg:grid-cols-4 gap-4">
                        <!-- å‹•æ…‹ç”Ÿæˆå›å ±ç‹€æ…‹ -->
                    </div>
                </div>
            </div>

            <!-- èª¿æ’¥å»ºè­° -->
            <div class="muji-card rounded-lg p-6">
                <h3 class="text-lg font-medium text-gray-800 mb-4">èª¿æ’¥å»ºè­°</h3>
                <div id="suggestions" class="space-y-2 text-sm text-gray-600">
                    <p>â€¢ ç³»çµ±æ­£åœ¨åˆ†æå„åº—åº«å­˜ç‹€æ³...</p>
                </div>
            </div>
        </div>

        <!-- åº—é•·æ“ä½œè¦–åœ– -->
        <div id="storeView" class="hidden">
            <div class="muji-card rounded-lg p-8">
                <h2 id="storeTitle" class="text-2xl font-light text-gray-800 mb-8 text-center">ä¿¡ç¾©åº—åº—å°äºŒåº«å­˜ç®¡ç†</h2>
                
                <div class="grid grid-cols-2 md:grid-cols-4 gap-6">
                    <!-- é£²æ–™1 -->
                    <div class="text-center">
                        <h3 class="text-xl font-medium text-gray-700 mb-6" id="storeBeverage1Name">ç´…èŒ¶</h3>
                        <div id="storeBeverage1Stack" class="bucket-stack bucket-stack-large mb-6"></div>
                        <p class="text-2xl font-light text-gray-800 mb-6" id="storeBeverage1Count">8.5æ¡¶</p>
                        <div class="flex justify-center space-x-2">
                            <button class="muji-button-outline px-3 py-2 rounded-full text-sm font-medium" onclick="adjustInventory('redTea', -1)">-</button>
                            <button class="muji-button px-3 py-2 rounded-full text-sm font-medium" onclick="adjustInventory('redTea', 1)">+</button>
                        </div>
                    </div>

                    <!-- é£²æ–™2 -->
                    <div class="text-center">
                        <h3 class="text-xl font-medium text-gray-700 mb-6" id="storeBeverage2Name">ç¶ èŒ¶</h3>
                        <div id="storeBeverage2Stack" class="bucket-stack bucket-stack-large mb-6"></div>
                        <p class="text-2xl font-light text-gray-800 mb-6" id="storeBeverage2Count">7.2æ¡¶</p>
                        <div class="flex justify-center space-x-2">
                            <button class="muji-button-outline px-3 py-2 rounded-full text-sm font-medium" onclick="adjustInventory('greenTea', -1)">-</button>
                            <button class="muji-button px-3 py-2 rounded-full text-sm font-medium" onclick="adjustInventory('greenTea', 1)">+</button>
                        </div>
                    </div>

                    <!-- é£²æ–™3 -->
                    <div class="text-center">
                        <h3 class="text-xl font-medium text-gray-700 mb-6" id="storeBeverage3Name">å’–å•¡</h3>
                        <div id="storeBeverage3Stack" class="bucket-stack bucket-stack-large mb-6"></div>
                        <p class="text-2xl font-light text-gray-800 mb-6" id="storeBeverage3Count">6.8æ¡¶</p>
                        <div class="flex justify-center space-x-2">
                            <button class="muji-button-outline px-3 py-2 rounded-full text-sm font-medium" onclick="adjustInventory('coffee', -1)">-</button>
                            <button class="muji-button px-3 py-2 rounded-full text-sm font-medium" onclick="adjustInventory('coffee', 1)">+</button>
                        </div>
                    </div>

                    <!-- é£²æ–™4 -->
                    <div class="text-center">
                        <h3 class="text-xl font-medium text-gray-700 mb-6" id="storeBeverage4Name">å¥¶èŒ¶</h3>
                        <div id="storeBeverage4Stack" class="bucket-stack bucket-stack-large mb-6"></div>
                        <p class="text-2xl font-light text-gray-800 mb-6" id="storeBeverage4Count">5.3æ¡¶</p>
                        <div class="flex justify-center space-x-2">
                            <button class="muji-button-outline px-3 py-2 rounded-full text-sm font-medium" onclick="adjustInventory('milkTea', -1)">-</button>
                            <button class="muji-button px-3 py-2 rounded-full text-sm font-medium" onclick="adjustInventory('milkTea', 1)">+</button>
                        </div>
                    </div>
                </div>

                <!-- å¿«é€Ÿæ“ä½œ -->
                <div class="mt-12 pt-8 border-t border-gray-200">
                    <h4 class="text-lg font-medium text-gray-700 mb-4 text-center">å¿«é€Ÿæ“ä½œ</h4>
                    <div class="flex justify-center space-x-4">
                        <button class="muji-button-outline px-6 py-3 rounded-lg" onclick="exportReport()">åŒ¯å‡ºå ±è¡¨</button>
                    </div>
                </div>
            </div>

            <!-- ä¾¿ç•¶é»å¿ƒåˆ°è²¨å›å ± -->
            <div class="muji-card rounded-lg p-8 mt-8">
                <h2 id="deliveryReportTitle" class="text-2xl font-light text-gray-800 mb-8 text-center">ä¾¿ç•¶é»å¿ƒåˆ°è²¨å›å ±</h2>
                
                <!-- é…é€æ•¸é‡é¡¯ç¤º -->
                <div class="grid grid-cols-2 gap-8 mb-8">
                    <div class="text-center">
                        <h3 class="text-xl font-medium text-gray-700 mb-4">ä¾¿ç•¶</h3>
                        <div class="grid grid-cols-2 gap-4">
                            <div class="muji-card rounded-lg p-4">
                                <p class="text-sm text-gray-600 mb-2">è‘·é£Ÿä¾¿ç•¶</p>
                                <p class="text-2xl font-light text-gray-800" id="storeMeatLunchBox">50å€‹</p>
                            </div>
                            <div class="muji-card rounded-lg p-4">
                                <p class="text-sm text-gray-600 mb-2">ç´ é£Ÿä¾¿ç•¶</p>
                                <p class="text-2xl font-light text-gray-800" id="storeVegLunchBox">20å€‹</p>
                            </div>
                        </div>
                    </div>
                    <div class="text-center">
                        <h3 class="text-xl font-medium text-gray-700 mb-4">é»å¿ƒ</h3>
                        <div class="grid grid-cols-2 gap-4">
                            <div class="muji-card rounded-lg p-4">
                                <p class="text-sm text-gray-600 mb-2">è‘·é£Ÿé»å¿ƒ</p>
                                <p class="text-2xl font-light text-gray-800" id="storeMeatSnack">30å€‹</p>
                            </div>
                            <div class="muji-card rounded-lg p-4">
                                <p class="text-sm text-gray-600 mb-2">ç´ é£Ÿé»å¿ƒ</p>
                                <p class="text-2xl font-light text-gray-800" id="storeVegSnack">15å€‹</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- å›å ±æŒ‰éˆ• -->
                <div class="text-center mb-8">
                    <div id="deliveryButtons" class="space-x-4">
                        <button class="muji-button px-8 py-3 rounded-lg text-lg" onclick="reportCorrect()">âœ“ æ•¸é‡æ­£ç¢º</button>
                        <button class="muji-button-outline px-8 py-3 rounded-lg text-lg" onclick="reportIncorrect()">âœ— æ•¸é‡ä¸æ­£ç¢º</button>
                    </div>
                    <div id="resetReportButton" class="hidden mt-4">
                        <button class="text-white px-6 py-2 rounded-lg text-sm transition-all duration-200 hover:transform hover:translate-y-[-1px]" style="background: #F06060;" onmouseover="this.style.background='#F3B562'" onmouseout="this.style.background='#F06060'" onclick="resetStoreReport()">ğŸ”„ é‡æ–°å›å ±</button>
                    </div>
                </div>

                <!-- å›å ±ç‹€æ…‹é¡¯ç¤º -->
                <div id="deliveryStatus" class="space-y-4">
                    <!-- å‹•æ…‹ç”Ÿæˆå›å ±ç‹€æ…‹ -->
                </div>

                <!-- ä¸æ­£ç¢ºåŸå› è¼¸å…¥ -->
                <div id="incorrectReasonSection" class="hidden mt-6 p-4 bg-red-50 rounded-lg">
                    <h4 class="text-lg font-medium text-red-800 mb-4">è«‹èªªæ˜ä¸æ­£ç¢ºåŸå› </h4>
                    <textarea id="incorrectReason" class="w-full px-4 py-3 border border-red-300 rounded-lg resize-none" rows="3" placeholder="è«‹è©³ç´°èªªæ˜æ”¶åˆ°çš„æ•¸é‡èˆ‡é æœŸä¸ç¬¦çš„æƒ…æ³..."></textarea>
                    <div class="text-center mt-4">
                        <button class="muji-button px-6 py-2 rounded-lg" onclick="submitIncorrectReason()">æäº¤åŸå› </button>
                        <button class="muji-button-outline px-6 py-2 rounded-lg ml-4" onclick="cancelIncorrectReport()">å–æ¶ˆ</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- æœŸåˆåº«å­˜è¨­å®šå½ˆçª— -->
    <div id="initialInventoryModal" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50 flex items-center justify-center">
        <div class="bg-white rounded-lg p-8 max-w-4xl w-full mx-4 max-h-96 overflow-y-auto">
            <h3 class="text-xl font-medium text-gray-800 mb-6 text-center">è¨­å®šæœŸåˆåº«å­˜</h3>
            <div id="initialInventoryGrid" class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <!-- å‹•æ…‹ç”Ÿæˆåº«å­˜è¨­å®šè¡¨æ ¼ -->
            </div>
            <div class="flex justify-center space-x-4 mt-8">
                <button class="muji-button px-6 py-3 rounded-lg" onclick="applyInitialInventory()">å¥—ç”¨è¨­å®š</button>
                <button class="muji-button-outline px-6 py-3 rounded-lg" onclick="closeInitialInventoryModal()">å–æ¶ˆ</button>
            </div>
        </div>
    </div>

    <!-- é…é€è¨­å®šå½ˆçª— -->
    <div id="deliverySettingsModal" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50 flex items-center justify-center">
        <div class="bg-white rounded-lg p-8 max-w-6xl w-full mx-4 max-h-96 overflow-y-auto">
            <h3 class="text-xl font-medium text-gray-800 mb-6 text-center">è¨­å®šå„åº—é…é€æ•¸é‡</h3>
            <div id="deliverySettingsGrid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                <!-- å‹•æ…‹ç”Ÿæˆé…é€è¨­å®šè¡¨æ ¼ -->
            </div>
            <div class="flex justify-center space-x-4 mt-8">
                <button class="muji-button px-6 py-3 rounded-lg" onclick="applyDeliverySettings()">å¥—ç”¨è¨­å®š</button>
                <button class="muji-button-outline px-6 py-3 rounded-lg" onclick="closeDeliverySettingsModal()">å–æ¶ˆ</button>
            </div>
        </div>
    </div>

    <script>
        // åº«å­˜è³‡æ–™
        let inventory = {
            store1: { redTea: 8.5, greenTea: 7.2, coffee: 6.8, milkTea: 5.3 },
            store2: { redTea: 6.3, greenTea: 5.1, coffee: 4.7, milkTea: 3.9 },
            store3: { redTea: 7.1, greenTea: 6.4, coffee: 5.2, milkTea: 4.6 },
            store4: { redTea: 5.8, greenTea: 4.9, coffee: 6.1, milkTea: 5.7 },
            store5: { redTea: 9.2, greenTea: 8.1, coffee: 7.3, milkTea: 6.8 },
            store6: { redTea: 4.6, greenTea: 3.8, coffee: 4.2, milkTea: 3.5 },
            store7: { redTea: 6.9, greenTea: 7.6, coffee: 5.9, milkTea: 4.8 },
            store8: { redTea: 8.1, greenTea: 6.7, coffee: 7.4, milkTea: 6.2 }
        };

        // é£²æ–™è¨­å®š
        let beverageSettings = {
            redTea: { name: 'ç´…èŒ¶', color: 'tea-red' },
            greenTea: { name: 'ç¶ èŒ¶', color: 'tea-green' },
            coffee: { name: 'å’–å•¡', color: 'coffee-brown' },
            milkTea: { name: 'å¥¶èŒ¶', color: 'milk-tea-beige' }
        };

        // åˆ†åº—åç¨±è¨­å®š
        let storeSettings = {
            store1: 'ä¿¡ç¾©åº—', store2: 'å¿ å­åº—', store3: 'å¤§å®‰åº—', store4: 'æ¾å±±åº—',
            store5: 'ä¸­å±±åº—', store6: 'è¬è¯åº—', store7: 'å…§æ¹–åº—', store8: 'å£«æ—åº—'
        };

        // æœŸåˆåº«å­˜è¨­å®š - å„åˆ†åº—å„é£²æ–™çš„æœŸåˆåº«å­˜
        let initialInventorySettings = {
            store1: { redTea: 10.0, greenTea: 9.0, coffee: 8.5, milkTea: 7.5 },
            store2: { redTea: 8.0, greenTea: 7.5, coffee: 7.0, milkTea: 6.5 },
            store3: { redTea: 9.0, greenTea: 8.0, coffee: 7.5, milkTea: 6.0 },
            store4: { redTea: 7.5, greenTea: 6.5, coffee: 8.0, milkTea: 7.0 },
            store5: { redTea: 10.5, greenTea: 9.5, coffee: 8.0, milkTea: 8.5 },
            store6: { redTea: 6.0, greenTea: 5.5, coffee: 6.0, milkTea: 5.0 },
            store7: { redTea: 8.5, greenTea: 9.0, coffee: 7.0, milkTea: 6.5 },
            store8: { redTea: 9.5, greenTea: 8.0, coffee: 8.5, milkTea: 7.5 }
        };

        // ä¾¿ç•¶é»å¿ƒé…é€è¨­å®š - å„åº—ç¨ç«‹è¨­å®š
        let deliverySettings = {};
        
        // åˆå§‹åŒ–å„åº—é…é€è¨­å®š
        Object.keys(storeSettings).forEach(storeKey => {
            deliverySettings[storeKey] = {
                meatLunchBox: 50,
                vegLunchBox: 20,
                meatSnack: 30,
                vegSnack: 15
            };
        });

        // å„åº—åˆ°è²¨å›å ±ç‹€æ…‹
        let deliveryReports = {};

        // åˆå§‹åŒ–å„åº—å›å ±ç‹€æ…‹
        Object.keys(storeSettings).forEach(storeKey => {
            deliveryReports[storeKey] = {
                status: 'pending', // pending, correct, incorrect, corrected
                firstReportTime: null,
                secondReportTime: null,
                incorrectReason: ''
            };
        });

        let currentRole = 'manager';
        let currentStore = 'store1';

        // åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            updateAllDisplays();
            updateDeliveryDisplays();
            
            document.getElementById('roleSelector').addEventListener('change', function(e) {
                switchRole(e.target.value);
            });
        });

        // åˆ‡æ›è§’è‰²
        function switchRole(role) {
            currentRole = role;
            
            if (role === 'manager') {
                document.getElementById('managerView').classList.remove('hidden');
                document.getElementById('storeView').classList.add('hidden');
                generateStoreOverview();
                updateDeliveryStatusOverview();
            } else {
                document.getElementById('managerView').classList.add('hidden');
                document.getElementById('storeView').classList.remove('hidden');
                
                currentStore = role;
                const storeName = storeSettings[role];
                document.getElementById('storeTitle').textContent = `${storeName}åº—å°äºŒåº«å­˜ç®¡ç†`;
                updateStoreView();
                updateStoreDeliveryView();
            }
        }

        // æ›´æ–°é£²æ–™åç¨±
        function updateBeverageNames() {
            const beverageKeys = ['redTea', 'greenTea', 'coffee', 'milkTea'];
            
            for (let i = 0; i < 4; i++) {
                const newName = document.getElementById(`beverage${i+1}Name`).value.trim();
                if (newName) {
                    beverageSettings[beverageKeys[i]].name = newName;
                }
            }
            
            updateAllDisplays();
            showNotification('é£²æ–™åç¨±å·²æ›´æ–°');
        }

        // æ›´æ–°åˆ†åº—åç¨±
        function updateStoreNames() {
            const storeKeys = Object.keys(storeSettings);
            
            for (let i = 0; i < 8; i++) {
                const newName = document.getElementById(`store${i+1}Name`).value.trim();
                if (newName) {
                    storeSettings[storeKeys[i]] = newName;
                }
            }
            
            updateRoleSelector();
            updateAllDisplays();
            showNotification('åˆ†åº—åç¨±å·²æ›´æ–°');
        }

        // æ›´æ–°è§’è‰²é¸æ“‡å™¨
        function updateRoleSelector() {
            const roleSelector = document.getElementById('roleSelector');
            const currentValue = roleSelector.value;
            
            // æ›´æ–°é¸é …æ–‡å­—
            const options = roleSelector.options;
            for (let i = 1; i < options.length; i++) {
                const storeKey = options[i].value;
                options[i].text = `${storeSettings[storeKey]}åº—å°äºŒ`;
            }
        }

        // é¡¯ç¤ºæœŸåˆåº«å­˜è¨­å®šå½ˆçª—
        function showInitialInventoryModal() {
            const modal = document.getElementById('initialInventoryModal');
            const grid = document.getElementById('initialInventoryGrid');
            
            grid.innerHTML = '';
            
            Object.keys(inventory).forEach(storeKey => {
                const storeName = storeSettings[storeKey];
                const store = inventory[storeKey];
                
                const storeDiv = document.createElement('div');
                storeDiv.className = 'muji-card rounded-lg p-4';
                
                let html = `<h4 class="text-lg font-medium text-gray-800 mb-4 text-center">${storeName}</h4>`;
                html += '<div class="space-y-3">';
                
                Object.keys(beverageSettings).forEach(bevKey => {
                    const bevName = beverageSettings[bevKey].name;
                    html += `
                        <div class="flex justify-between items-center">
                            <label class="text-sm text-gray-600">${bevName}</label>
                            <input type="number" id="init_${storeKey}_${bevKey}" 
                                   class="w-20 px-2 py-1 border border-gray-300 rounded text-center" 
                                   value="${store[bevKey].toFixed(1)}" step="0.1" min="0" max="20">
                        </div>
                    `;
                });
                
                html += '</div>';
                storeDiv.innerHTML = html;
                grid.appendChild(storeDiv);
            });
            
            modal.classList.remove('hidden');
        }

        // é—œé–‰æœŸåˆåº«å­˜è¨­å®šå½ˆçª—
        function closeInitialInventoryModal() {
            document.getElementById('initialInventoryModal').classList.add('hidden');
        }

        // å¥—ç”¨æœŸåˆåº«å­˜è¨­å®š
        function applyInitialInventory() {
            Object.keys(inventory).forEach(storeKey => {
                Object.keys(beverageSettings).forEach(bevKey => {
                    const input = document.getElementById(`init_${storeKey}_${bevKey}`);
                    if (input) {
                        const value = parseFloat(input.value) || 0;
                        inventory[storeKey][bevKey] = Math.max(0, Math.min(20, value));
                    }
                });
            });
            
            updateAllDisplays();
            closeInitialInventoryModal();
            showNotification('æœŸåˆåº«å­˜å·²æ›´æ–°');
        }

        // èª¿æ•´åº«å­˜
        function adjustInventory(beverage, change) {
            const store = inventory[currentStore];
            const newValue = Math.max(0, Math.min(20, Math.round((store[beverage] + change * 0.1) * 10) / 10));
            
            if (newValue !== store[beverage]) {
                store[beverage] = newValue;
                updateAllDisplays();
                showNotification(`${getBeverageName(beverage)}åº«å­˜å·²${change > 0 ? 'å¢åŠ ' : 'æ¸›å°‘'}`);
            }
        }

        // å¿«é€Ÿè£œæ»¿
        function quickRefill() {
            const store = inventory[currentStore];
            store.redTea = 10.0;
            store.greenTea = 10.0;
            store.coffee = 10.0;
            store.milkTea = 10.0;
            updateAllDisplays();
            showNotification('æ‰€æœ‰é£²æ–™å·²è£œæ»¿');
        }

        // åŒ¯å‡ºå ±è¡¨
        function exportReport() {
            const storeName = storeSettings[currentStore];
            const store = inventory[currentStore];
            const beverageKeys = Object.keys(beverageSettings);
            
            let report = `${storeName}åº«å­˜å ±è¡¨\n`;
            let total = 0;
            
            beverageKeys.forEach(key => {
                const name = beverageSettings[key].name;
                const amount = store[key];
                report += `${name}: ${amount.toFixed(1)}æ¡¶\n`;
                total += amount;
            });
            
            report += `ç¸½è¨ˆ: ${total.toFixed(1)}æ¡¶`;
            
            // æ¨¡æ“¬ä¸‹è¼‰
            const blob = new Blob([report], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `${storeName}åº«å­˜å ±è¡¨.txt`;
            a.click();
            URL.revokeObjectURL(url);
            
            showNotification('å ±è¡¨å·²åŒ¯å‡º');
        }

        // æ›´æ–°æ‰€æœ‰é¡¯ç¤º
        function updateAllDisplays() {
            updateManagerView();
            updateStoreView();
        }

        // æ›´æ–°å€ç¶“ç†è¦–åœ–
        function updateManagerView() {
            const beverageKeys = Object.keys(beverageSettings);
            const total = {};
            
            // è¨ˆç®—ç¸½åº«å­˜
            beverageKeys.forEach(key => {
                total[key] = 0;
                Object.keys(inventory).forEach(store => {
                    total[key] += inventory[store][key];
                });
            });

            // è¨ˆç®—å„é£²æ–™çš„æœŸåˆç¸½é‡
            const initialTotal = {};
            beverageKeys.forEach(key => {
                initialTotal[key] = 0;
                Object.keys(initialInventorySettings).forEach(store => {
                    initialTotal[key] += initialInventorySettings[store][key];
                });
            });

            // æ›´æ–°ç¸½åº«å­˜é¡¯ç¤º
            beverageKeys.forEach((key, index) => {
                const setting = beverageSettings[key];
                const initialAmount = initialTotal[key];
                const currentAmount = total[key];
                const percentage = Math.round((currentAmount / initialAmount) * 100);
                const fillPercentage = Math.min(100, percentage); // ç”¨æ–¼è¦–è¦ºé¡¯ç¤º
                
                document.getElementById(`totalBeverage${index+1}Fill`).style.height = `${Math.max(10, fillPercentage)}%`;
                document.getElementById(`totalBeverage${index+1}Count`).textContent = `${currentAmount.toFixed(1)}æ¡¶`;
                document.getElementById(`totalBeverage${index+1}Percent`).textContent = `${percentage}%`;
                document.getElementById(`totalBeverage${index+1}Initial`).textContent = `æœŸåˆ ${initialAmount.toFixed(1)}æ¡¶`;
                document.getElementById(`totalBeverage${index+1}Name`).textContent = setting.name;
            });

            // æ›´æ–°åˆ†åº—ç¸½è¦½
            generateStoreOverview();

            // æ›´æ–°å»ºè­°
            updateSuggestions();
        }

        // ç”Ÿæˆåˆ†åº—ç¸½è¦½
        function generateStoreOverview() {
            const storeOverview = document.getElementById('storeOverview');
            storeOverview.innerHTML = '';

            Object.keys(inventory).forEach(storeKey => {
                const storeCard = document.createElement('div');
                storeCard.className = 'muji-card rounded-lg p-4';
                
                const storeName = storeSettings[storeKey];
                const store = inventory[storeKey];
                const beverageKeys = Object.keys(beverageSettings);
                
                let cardHTML = `<h4 class="text-md font-medium text-gray-800 mb-4 text-center">${storeName}</h4>`;
                cardHTML += '<div class="grid grid-cols-2 gap-3">';
                
                beverageKeys.forEach(key => {
                    const setting = beverageSettings[key];
                    cardHTML += `
                        <div class="text-center">
                            <p class="text-xs text-gray-600 mb-1">${setting.name}</p>
                            <div id="${storeKey}${key}Stack" class="bucket-stack" style="min-height: 60px; max-height: 80px;"></div>
                            <p class="mt-1 text-sm font-light">${store[key].toFixed(1)}æ¡¶</p>
                        </div>
                    `;
                });
                
                cardHTML += '</div>';
                storeCard.innerHTML = cardHTML;
                storeOverview.appendChild(storeCard);
                
                // æ›´æ–°æ¡¶å­é¡¯ç¤º
                beverageKeys.forEach(key => {
                    const setting = beverageSettings[key];
                    updateBucketStack(`${storeKey}${key}Stack`, store[key], setting.color);
                });
            });
        }

        // æ›´æ–°åº—é•·è¦–åœ–
        function updateStoreView() {
            if (currentRole === 'manager') return;
            
            const store = inventory[currentStore];
            const beverageKeys = Object.keys(beverageSettings);
            
            beverageKeys.forEach((key, index) => {
                const setting = beverageSettings[key];
                updateBucketStack(`storeBeverage${index+1}Stack`, store[key], setting.color);
                document.getElementById(`storeBeverage${index+1}Count`).textContent = `${store[key].toFixed(1)}æ¡¶`;
                document.getElementById(`storeBeverage${index+1}Name`).textContent = setting.name;
            });
        }

        // æ›´æ–°å †ç–Šæ¡¶å­é¡¯ç¤º
        function updateBucketStack(elementId, amount, colorClass) {
            const container = document.getElementById(elementId);
            container.innerHTML = '';
            
            const fullBuckets = Math.floor(amount);
            const partialBucket = amount - fullBuckets;
            
            // è¨ˆç®—éœ€è¦å¤šå°‘å€‹5æ¡¶çš„å®Œæ•´åˆ—
            const fullColumns = Math.floor(fullBuckets / 5);
            const remainingBuckets = fullBuckets % 5;
            
            // å‰µå»ºå®Œæ•´çš„5æ¡¶åˆ—
            for (let col = 0; col < fullColumns; col++) {
                const columnDiv = document.createElement('div');
                columnDiv.className = 'bucket-column';
                
                for (let i = 0; i < 5; i++) {
                    const bucket = createSmallBucket(colorClass, 100);
                    columnDiv.appendChild(bucket);
                }
                
                container.appendChild(columnDiv);
            }
            
            // å¦‚æœæœ‰å‰©é¤˜æ¡¶å­æˆ–å°æ•¸éƒ¨åˆ†ï¼Œå‰µå»ºæœ€å¾Œä¸€åˆ—
            if (remainingBuckets > 0 || partialBucket > 0) {
                const columnDiv = document.createElement('div');
                columnDiv.className = 'bucket-column';
                
                // å…ˆæ·»åŠ å®Œæ•´çš„å‰©é¤˜æ¡¶å­
                for (let i = 0; i < remainingBuckets; i++) {
                    const bucket = createSmallBucket(colorClass, 100);
                    columnDiv.appendChild(bucket);
                }
                
                // å¦‚æœæœ‰å°æ•¸éƒ¨åˆ†ï¼Œæ·»åŠ éƒ¨åˆ†æ¡¶å­åœ¨æœ€ä¸Šæ–¹
                if (partialBucket > 0) {
                    const bucket = createSmallBucket(colorClass, partialBucket * 100);
                    columnDiv.appendChild(bucket);
                }
                
                container.appendChild(columnDiv);
            }
        }
        
        // å‰µå»ºå°æ¡¶å­å…ƒç´ 
        function createSmallBucket(colorClass, fillPercentage) {
            const bucket = document.createElement('div');
            bucket.className = 'small-bucket';
            
            const container = document.createElement('div');
            container.className = 'small-bucket-container';
            
            const liquid = document.createElement('div');
            liquid.className = `small-bucket-liquid ${colorClass}`;
            liquid.style.height = `${Math.max(10, fillPercentage)}%`;
            
            const handle = document.createElement('div');
            handle.className = 'small-bucket-handle';
            
            container.appendChild(liquid);
            bucket.appendChild(container);
            bucket.appendChild(handle);
            
            return bucket;
        }

        // æ›´æ–°å»ºè­°
        function updateSuggestions() {
            const suggestions = [];
            const beverageKeys = Object.keys(beverageSettings);
            
            // æª¢æŸ¥ä½åº«å­˜
            Object.keys(inventory).forEach(storeKey => {
                const store = inventory[storeKey];
                const storeName = storeSettings[storeKey];
                
                beverageKeys.forEach(bevKey => {
                    const beverageName = beverageSettings[bevKey].name;
                    if (store[bevKey] < 2) {
                        suggestions.push(`â€¢ ${storeName}${beverageName}åº«å­˜åä½(${store[bevKey].toFixed(1)}æ¡¶)ï¼Œå»ºè­°è£œè²¨`);
                    }
                });
            });
            
            // æª¢æŸ¥èª¿æ’¥æ©Ÿæœƒ
            beverageKeys.forEach(bevKey => {
                const beverageName = beverageSettings[bevKey].name;
                const highStores = [];
                const lowStores = [];
                
                Object.keys(inventory).forEach(storeKey => {
                    const amount = inventory[storeKey][bevKey];
                    if (amount > 8) highStores.push({store: storeKey, amount});
                    if (amount < 2) lowStores.push({store: storeKey, amount});
                });
                
                if (highStores.length > 0 && lowStores.length > 0) {
                    const highStore = storeSettings[highStores[0].store];
                    const lowStore = storeSettings[lowStores[0].store];
                    suggestions.push(`â€¢ å¯è€ƒæ…®å°‡${highStore}çš„${beverageName}èª¿æ’¥è‡³${lowStore}`);
                }
            });
            
            if (suggestions.length === 0) {
                suggestions.push('â€¢ ç›®å‰åº«å­˜ç‹€æ³è‰¯å¥½ï¼Œå„åº—åº«å­˜å‡è¡¡');
            }
            
            document.getElementById('suggestions').innerHTML = suggestions.slice(0, 5).join('<br>');
        }

        // é¡¯ç¤ºé€šçŸ¥
        function showNotification(message) {
            const notification = document.getElementById('notification');
            notification.textContent = message;
            notification.classList.add('show');
            
            setTimeout(() => {
                notification.classList.remove('show');
            }, 2000);
        }

        // ç²å–é£²æ–™åç¨±
        function getBeverageName(beverage) {
            return beverageSettings[beverage] ? beverageSettings[beverage].name : beverage;
        }

        // é¡¯ç¤ºé…é€è¨­å®šå½ˆçª—
        function showDeliverySettingsModal() {
            const modal = document.getElementById('deliverySettingsModal');
            const grid = document.getElementById('deliverySettingsGrid');
            
            grid.innerHTML = '';
            
            Object.keys(storeSettings).forEach(storeKey => {
                const storeName = storeSettings[storeKey];
                const settings = deliverySettings[storeKey];
                
                const storeDiv = document.createElement('div');
                storeDiv.className = 'muji-card rounded-lg p-4';
                
                let html = `<h4 class="text-lg font-medium text-gray-800 mb-4 text-center">${storeName}</h4>`;
                html += '<div class="space-y-3">';
                
                html += `
                    <div class="grid grid-cols-2 gap-3">
                        <div>
                            <label class="block text-xs text-gray-600 mb-1">è‘·é£Ÿä¾¿ç•¶</label>
                            <input type="number" id="delivery_${storeKey}_meatLunchBox" 
                                   class="w-full px-2 py-1 border border-gray-300 rounded text-center text-sm" 
                                   value="${settings.meatLunchBox}" min="0">
                        </div>
                        <div>
                            <label class="block text-xs text-gray-600 mb-1">ç´ é£Ÿä¾¿ç•¶</label>
                            <input type="number" id="delivery_${storeKey}_vegLunchBox" 
                                   class="w-full px-2 py-1 border border-gray-300 rounded text-center text-sm" 
                                   value="${settings.vegLunchBox}" min="0">
                        </div>
                        <div>
                            <label class="block text-xs text-gray-600 mb-1">è‘·é£Ÿé»å¿ƒ</label>
                            <input type="number" id="delivery_${storeKey}_meatSnack" 
                                   class="w-full px-2 py-1 border border-gray-300 rounded text-center text-sm" 
                                   value="${settings.meatSnack}" min="0">
                        </div>
                        <div>
                            <label class="block text-xs text-gray-600 mb-1">ç´ é£Ÿé»å¿ƒ</label>
                            <input type="number" id="delivery_${storeKey}_vegSnack" 
                                   class="w-full px-2 py-1 border border-gray-300 rounded text-center text-sm" 
                                   value="${settings.vegSnack}" min="0">
                        </div>
                    </div>
                `;
                
                html += '</div>';
                storeDiv.innerHTML = html;
                grid.appendChild(storeDiv);
            });
            
            modal.classList.remove('hidden');
        }

        // é—œé–‰é…é€è¨­å®šå½ˆçª—
        function closeDeliverySettingsModal() {
            document.getElementById('deliverySettingsModal').classList.add('hidden');
        }

        // å¥—ç”¨é…é€è¨­å®š
        function applyDeliverySettings() {
            Object.keys(storeSettings).forEach(storeKey => {
                const meatLunchBoxInput = document.getElementById(`delivery_${storeKey}_meatLunchBox`);
                const vegLunchBoxInput = document.getElementById(`delivery_${storeKey}_vegLunchBox`);
                const meatSnackInput = document.getElementById(`delivery_${storeKey}_meatSnack`);
                const vegSnackInput = document.getElementById(`delivery_${storeKey}_vegSnack`);
                
                if (meatLunchBoxInput) deliverySettings[storeKey].meatLunchBox = parseInt(meatLunchBoxInput.value) || 0;
                if (vegLunchBoxInput) deliverySettings[storeKey].vegLunchBox = parseInt(vegLunchBoxInput.value) || 0;
                if (meatSnackInput) deliverySettings[storeKey].meatSnack = parseInt(meatSnackInput.value) || 0;
                if (vegSnackInput) deliverySettings[storeKey].vegSnack = parseInt(vegSnackInput.value) || 0;
            });
            
            updateDeliveryDisplays();
            closeDeliverySettingsModal();
            showNotification('å„åº—é…é€è¨­å®šå·²æ›´æ–°');
        }

        // é‡ç½®æ‰€æœ‰å›å ±ç‹€æ…‹
        function resetAllDeliveryStatus() {
            Object.keys(deliveryReports).forEach(storeKey => {
                deliveryReports[storeKey] = {
                    status: 'pending',
                    firstReportTime: null,
                    secondReportTime: null,
                    incorrectReason: ''
                };
            });
            
            updateDeliveryDisplays();
            showNotification('æ‰€æœ‰å›å ±ç‹€æ…‹å·²é‡ç½®');
        }

        // æ›´æ–°é…é€ç›¸é—œé¡¯ç¤º
        function updateDeliveryDisplays() {
            updateDeliveryStatusOverview();
            updateStoreDeliveryView();
        }

        // æ›´æ–°å¤§ç¸½ç®¡çš„é…é€ç‹€æ…‹ç¸½è¦½
        function updateDeliveryStatusOverview() {
            const overview = document.getElementById('deliveryStatusOverview');
            if (!overview) return;
            
            overview.innerHTML = '';
            
            Object.keys(storeSettings).forEach(storeKey => {
                const storeName = storeSettings[storeKey];
                const report = deliveryReports[storeKey];
                
                const statusCard = document.createElement('div');
                statusCard.className = 'muji-card rounded-lg p-3';
                
                let statusText = '';
                let statusColor = '';
                
                switch (report.status) {
                    case 'pending':
                        statusText = 'å¾…å›å ±';
                        statusColor = 'text-gray-600';
                        break;
                    case 'correct':
                        statusText = 'å·²ç¢ºèªæ­£ç¢º';
                        statusColor = 'text-green-600';
                        break;
                    case 'incorrect':
                        statusText = 'æ•¸é‡ä¸æ­£ç¢º';
                        statusColor = 'text-red-600';
                        break;
                    case 'corrected':
                        statusText = 'å·²é‡æ–°ç¢ºèª';
                        statusColor = 'text-blue-600';
                        break;
                }
                
                let timeInfo = '';
                if (report.firstReportTime) {
                    timeInfo += `<p class="text-xs text-gray-500 mt-1">é¦–æ¬¡: ${report.firstReportTime}</p>`;
                }
                if (report.secondReportTime) {
                    timeInfo += `<p class="text-xs text-gray-500">äºŒæ¬¡: ${report.secondReportTime}</p>`;
                }
                
                statusCard.innerHTML = `
                    <h5 class="text-sm font-medium text-gray-800">${storeName}</h5>
                    <p class="text-sm ${statusColor} mt-1">${statusText}</p>
                    ${timeInfo}
                `;
                
                overview.appendChild(statusCard);
            });
        }

        // æ›´æ–°åº—å°äºŒçš„é…é€å›å ±é é¢
        function updateStoreDeliveryView() {
            if (currentRole === 'manager') return;
            
            // æ›´æ–°é…é€æ•¸é‡é¡¯ç¤º
            const storeSettings = deliverySettings[currentStore];
            document.getElementById('storeMeatLunchBox').textContent = `${storeSettings.meatLunchBox}å€‹`;
            document.getElementById('storeVegLunchBox').textContent = `${storeSettings.vegLunchBox}å€‹`;
            document.getElementById('storeMeatSnack').textContent = `${storeSettings.meatSnack}å€‹`;
            document.getElementById('storeVegSnack').textContent = `${storeSettings.vegSnack}å€‹`;
            
            // æ›´æ–°å›å ±ç‹€æ…‹
            const report = deliveryReports[currentStore];
            const statusDiv = document.getElementById('deliveryStatus');
            const buttonsDiv = document.getElementById('deliveryButtons');
            
            statusDiv.innerHTML = '';
            
            const resetButton = document.getElementById('resetReportButton');
            
            if (report.status === 'pending') {
                // å¾…å›å ±ç‹€æ…‹ï¼Œé¡¯ç¤ºæŒ‰éˆ•
                buttonsDiv.classList.remove('hidden');
                resetButton.classList.add('hidden');
            } else if (report.status === 'correct') {
                // å·²ç¢ºèªæ­£ç¢º
                buttonsDiv.classList.add('hidden');
                resetButton.classList.remove('hidden');
                statusDiv.innerHTML = `
                    <div class="text-center p-6 bg-green-50 rounded-lg">
                        <div class="text-green-600 text-2xl mb-2">âœ“</div>
                        <h4 class="text-lg font-medium text-green-800 mb-2">æ•¸é‡ç¢ºèªæ­£ç¢º</h4>
                        <p class="text-sm text-green-600">å›å ±æ™‚é–“: ${report.firstReportTime}</p>
                    </div>
                `;
            } else if (report.status === 'incorrect') {
                // æ•¸é‡ä¸æ­£ç¢ºï¼Œç­‰å¾…é‡æ–°ç¢ºèª
                buttonsDiv.innerHTML = `
                    <button class="muji-button px-8 py-3 rounded-lg text-lg" onclick="reportCorrect()">âœ“ é‡æ–°ç¢ºèªæ­£ç¢º</button>
                `;
                resetButton.classList.remove('hidden');
                statusDiv.innerHTML = `
                    <div class="text-center p-6 bg-red-50 rounded-lg mb-4">
                        <div class="text-red-600 text-2xl mb-2">âœ—</div>
                        <h4 class="text-lg font-medium text-red-800 mb-2">æ•¸é‡ä¸æ­£ç¢º</h4>
                        <p class="text-sm text-red-600 mb-2">å›å ±æ™‚é–“: ${report.firstReportTime}</p>
                        <p class="text-sm text-red-700 bg-red-100 p-2 rounded">åŸå› : ${report.incorrectReason}</p>
                    </div>
                `;
            } else if (report.status === 'corrected') {
                // å·²é‡æ–°ç¢ºèª
                buttonsDiv.classList.add('hidden');
                resetButton.classList.remove('hidden');
                statusDiv.innerHTML = `
                    <div class="space-y-4">
                        <div class="text-center p-4 bg-red-50 rounded-lg">
                            <div class="text-red-600 text-xl mb-2">âœ—</div>
                            <h4 class="text-md font-medium text-red-800 mb-2">é¦–æ¬¡æ•¸é‡ä¸æ­£ç¢º</h4>
                            <p class="text-xs text-red-600 mb-2">å›å ±æ™‚é–“: ${report.firstReportTime}</p>
                            <p class="text-xs text-red-700 bg-red-100 p-2 rounded">åŸå› : ${report.incorrectReason}</p>
                        </div>
                        <div class="text-center p-4 bg-green-50 rounded-lg">
                            <div class="text-green-600 text-xl mb-2">âœ“</div>
                            <h4 class="text-md font-medium text-green-800 mb-2">é‡æ–°ç¢ºèªæ­£ç¢º</h4>
                            <p class="text-xs text-green-600">ç¢ºèªæ™‚é–“: ${report.secondReportTime}</p>
                        </div>
                    </div>
                `;
            }
        }

        // å›å ±æ•¸é‡æ­£ç¢º
        function reportCorrect() {
            const report = deliveryReports[currentStore];
            const currentTime = new Date().toLocaleString('zh-TW');
            
            if (report.status === 'pending') {
                // é¦–æ¬¡å›å ±æ­£ç¢º
                report.status = 'correct';
                report.firstReportTime = currentTime;
                showNotification('å·²ç¢ºèªæ•¸é‡æ­£ç¢º');
            } else if (report.status === 'incorrect') {
                // é‡æ–°ç¢ºèªæ­£ç¢º
                report.status = 'corrected';
                report.secondReportTime = currentTime;
                showNotification('å·²é‡æ–°ç¢ºèªæ•¸é‡æ­£ç¢º');
            }
            
            updateDeliveryDisplays();
        }

        // å›å ±æ•¸é‡ä¸æ­£ç¢º
        function reportIncorrect() {
            document.getElementById('incorrectReasonSection').classList.remove('hidden');
            document.getElementById('deliveryButtons').classList.add('hidden');
        }

        // æäº¤ä¸æ­£ç¢ºåŸå› 
        function submitIncorrectReason() {
            const reason = document.getElementById('incorrectReason').value.trim();
            
            if (!reason) {
                alert('è«‹å¡«å¯«ä¸æ­£ç¢ºçš„åŸå› ');
                return;
            }
            
            const report = deliveryReports[currentStore];
            const currentTime = new Date().toLocaleString('zh-TW');
            
            report.status = 'incorrect';
            report.firstReportTime = currentTime;
            report.incorrectReason = reason;
            
            document.getElementById('incorrectReasonSection').classList.add('hidden');
            document.getElementById('incorrectReason').value = '';
            
            updateDeliveryDisplays();
            showNotification('å·²å›å ±æ•¸é‡ä¸æ­£ç¢º');
        }

        // å–æ¶ˆä¸æ­£ç¢ºå›å ±
        function cancelIncorrectReport() {
            document.getElementById('incorrectReasonSection').classList.add('hidden');
            document.getElementById('deliveryButtons').classList.remove('hidden');
            document.getElementById('incorrectReason').value = '';
        }

        // é‡ç½®å–®åº—å›å ±ç‹€æ…‹
        function resetStoreReport() {
            if (confirm('ç¢ºå®šè¦é‡æ–°å›å ±å—ï¼Ÿé€™å°‡æ¸…é™¤ç›®å‰çš„å›å ±è¨˜éŒ„ã€‚')) {
                const report = deliveryReports[currentStore];
                report.status = 'pending';
                report.firstReportTime = null;
                report.secondReportTime = null;
                report.incorrectReason = '';
                
                // é‡ç½®æŒ‰éˆ•ç‹€æ…‹
                const buttonsDiv = document.getElementById('deliveryButtons');
                buttonsDiv.innerHTML = `
                    <button class="muji-button px-8 py-3 rounded-lg text-lg" onclick="reportCorrect()">âœ“ æ•¸é‡æ­£ç¢º</button>
                    <button class="muji-button-outline px-8 py-3 rounded-lg text-lg" onclick="reportIncorrect()">âœ— æ•¸é‡ä¸æ­£ç¢º</button>
                `;
                
                updateDeliveryDisplays();
                showNotification('å›å ±ç‹€æ…‹å·²é‡ç½®ï¼Œå¯é‡æ–°å›å ±');
            }
        }
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'962ff708521f49fa',t:'MTc1MzE1NjEzMy4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
